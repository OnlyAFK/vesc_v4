/**
 * @file    position_loop.h
 * @brief   ?????? (???)
 * @note    ?????????????????? foc_core.h
 */

#ifndef __POSITION_LOOP_H
#define __POSITION_LOOP_H

/*============================================================================*/
/*                    ??????????                                      */
/*============================================================================*/

/**
 * @brief ??? PID ??? (????)
 */
typedef struct {
    float Kp;           // ???????
    float Max_RPM;      // ?????? (?????????)
    
    float Target_Pos;   // ?????? (rad)
    float Current_Pos;  // ?????? (rad)
    
    int   Total_Turns;  // ?????
    float Last_Theta;   // ???????? (0~2PI)
    float Last_Target_Pos; // ???????? (??????)
} Pos_PID_t;

/*============================================================================*/
/*                    ??????????                                      */
/*============================================================================*/

extern Pos_PID_t pid_pos;

/*============================================================================*/
/*                    ????????                                          */
/*============================================================================*/

/**
 * @brief  ??????
 * @param  pid: ????????
 */
void Pos_Loop_Init(Pos_PID_t *pid);

/**
 * @brief  ?????????
 * @param  pid: ????????
 * @param  raw_theta: ?????? (0~2?)
 */
void Pos_Update_Sensor(Pos_PID_t *pid, float raw_theta);

/**
 * @brief  ??? PID ??
 * @param  pid: ????????
 * @return ???? (RPM)
 */
float Pos_PID_Calc(Pos_PID_t *pid);

#endif /* __POSITION_LOOP_H */
